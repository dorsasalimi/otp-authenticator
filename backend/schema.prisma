// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String    @id @default(uuid()) @postgresql.Uuid
  name      String    @default("")
  email     String    @unique @default("")
  password  String?
  posts     Post[]    @relation("Post_author")
  createdAt DateTime? @default(now())
}

model Post {
  id       String  @id @default(uuid()) @postgresql.Uuid
  title    String  @default("")
  content  Json    @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  author   User?   @relation("Post_author", fields: [authorId], references: [id])
  authorId String? @map("author") @postgresql.Uuid
  tags     Tag[]   @relation("Post_tags")

  @@index([authorId])
}

model Tag {
  id    String @id @default(uuid()) @postgresql.Uuid
  name  String @default("")
  posts Post[] @relation("Post_tags")
}

model OtpUser {
  id                        String            @id @default(uuid()) @postgresql.Uuid
  phoneNumber               String            @unique @default("")
  isPhoneVerified           Boolean           @default(false)
  pin                       String?
  pinEnabled                Boolean           @default(false)
  pinLastChangedAt          DateTime?
  tokens                    OTPToken[]        @relation("OTPToken_user")
  verificationCode          String?
  verificationExpire        DateTime?
  createdAt                 DateTime?         @default(now())
  from_OTPTokenHistory_user OTPTokenHistory[] @relation("OTPTokenHistory_user")
}

model App {
  id                       String            @id @default(uuid()) @postgresql.Uuid
  name                     String            @default("")
  slug                     String            @unique @default("")
  apiKey                   String            @unique @default("")
  issuer                   String            @default("")
  tokens                   OTPToken[]        @relation("OTPToken_app")
  from_OTPTokenHistory_app OTPTokenHistory[] @relation("OTPTokenHistory_app")
}

model OTPToken {
  id                   String      @id @default(uuid()) @postgresql.Uuid
  user                 OtpUser?    @relation("OTPToken_user", fields: [userId], references: [id])
  userId               String?     @map("user") @postgresql.Uuid
  app                  App?        @relation("OTPToken_app", fields: [appId], references: [id])
  appId                String?     @map("app") @postgresql.Uuid
  encryptedSecret      String      @default("")
  isVerified           Boolean     @default(false)
  lastUsedAt           DateTime?
  createdAt            DateTime?   @default(now())
  from_AccessLog_token AccessLog[] @relation("AccessLog_token")

  @@index([userId])
  @@index([appId])
}

model OTPTokenHistory {
  id                String    @id @default(uuid()) @postgresql.Uuid
  user              OtpUser?  @relation("OTPTokenHistory_user", fields: [userId], references: [id])
  userId            String?   @map("user") @postgresql.Uuid
  app               App?      @relation("OTPTokenHistory_app", fields: [appId], references: [id])
  appId             String?   @map("app") @postgresql.Uuid
  appNameAtDeletion String    @default("")
  createdAtOriginal DateTime?
  lastUsedAt        DateTime?
  deletedAt         DateTime? @default(now())

  @@index([userId])
  @@index([appId])
}

model AccessLog {
  id        String    @id @default(uuid()) @postgresql.Uuid
  timestamp DateTime? @default(now())
  token     OTPToken? @relation("AccessLog_token", fields: [tokenId], references: [id])
  tokenId   String?   @map("token") @postgresql.Uuid
  action    String?
  ipAddress String    @default("")
  userAgent String    @default("")
  metadata  String    @default("")

  @@index([tokenId])
}
